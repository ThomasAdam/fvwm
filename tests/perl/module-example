#!/usr/bin/perl -w

use strict;
use lib `fvwm-config -p | tr -d '\n'`;
use FVWM::Module;

my $newWindowHandler = sub {
	my $self = shift;
	my $type = shift;
	my @args = @_;
	#$self->send("Echo M_ADD_WINDOW @args");

	# auto iconify all new windows
	my $winId = $args[0];
	$self->send("Iconify true", $winId);
};

my $onExit = sub { $_[0]->send("All (FvwmConsole) Iconify false") };

my $module = new FVWM::Module(
	Name => "FvwmPerlBasedExample",
	Mask => M_ADD_WINDOW | M_FOCUS_CHANGE,
);
$module->send("Beep");
$module->send("All (FvwmConsole) Iconify true");
$module->send("Schedule 60000 KillModule $0");

# auto-iconify new windows
$module->addHandler(M_ADD_WINDOW, $newWindowHandler);
# auto-raise windows
$module->addHandler(M_FOCUS_CHANGE, sub { $_[0]->send("Raise", $_[2]) });
# this would be our final song if only we were not killed by KillModule...
$module->addHandler(ON_EXIT, $onExit);

$module->eventLoop();
